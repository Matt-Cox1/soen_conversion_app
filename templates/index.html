<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOEN Phenomenological Model Converter</title>
    <!-- MathJax Setup -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                packages: ['base', 'ams', 'noerrors', 'noundefined']
            },
            startup: {
                ready: () => {
                    MathJax.startup.defaultReady();
                }
            }
        };
    </script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --bg-color: #f5f6fa;
            --input-bg: #ffffff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 2rem;
            background-color: var(--bg-color);
            color: var(--primary-color);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 2rem;
            font-size: 2.5rem;
        }

        .converter-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .converter-section {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .input-group {
            margin-bottom: 1rem;
            display: flex;
            flex-direction: column;
        }

        label {
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        input {
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        input:focus {
            border-color: var(--secondary-color);
            outline: none;
        }

        button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
            width: 100%;
            margin-top: 1rem;
        }

        button:hover {
            background-color: #2980b9;
        }

        .result {
            margin-top: 1rem;
            padding: 1rem;
            background-color: var(--bg-color);
            border-radius: 5px;
            font-family: 'Roboto', sans-serif;
            line-height: 1.5;
        }

        .loading {
            background-color: #95a5a6 !important;
            cursor: wait !important;
        }

        .tab-container {
            border-bottom: 1px solid #ddd;
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 1rem 2rem;
            font-size: 1rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            width: auto;
            color: var(--primary-color);
            margin: 0;
        }

        .tab-button:hover {
            background-color: rgba(52, 152, 219, 0.1);
        }

        .tab-button.active {
            border-bottom: 3px solid var(--secondary-color);
            color: var(--secondary-color);
            font-weight: 500;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .constants-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .derived-constants {
            grid-column: 1 / -1;
            background-color: var(--bg-color);
            padding: 1.5rem;
            border-radius: 5px;
            margin-top: 1rem;
        }
    </style>
</head>


<body>
    <div class="container">
        <h1>SOEN Phenomenological Model Converter</h1>
        <div class="converter-grid">
            <!-- Convert to Physical Section -->
            <div class="converter-section">
                <h2>Dimensionless to Physical</h2>
                <div class="input-group">
                    <label for="i">Dimensionless Current (i)</label>
                    <input id="i" type="number" step="any">
                </div>
                <div class="input-group">
                    <label for="phi">Dimensionless Flux (φ)</label>
                    <input id="phi" type="number" step="any">
                </div>
                <div class="input-group">
                    <label for="J">Dimensionless Inductance (J)</label>
                    <input id="J" type="number" step="any">
                </div>
                <div class="input-group">
                    <label for="t_prime">Dimensionless Time (t')</label>
                    <input id="t_prime" type="number" step="any">
                </div>
                <div class="input-group">
                    <label for="g_fq">Dimensionless Flux Quantum Rate (g_fq)</label>
                    <input id="g_fq" type="number" step="any">
                </div>
                <button onclick="convertToPhysical()">Convert to Physical Units</button>
                <div id="physicalResult" class="result"></div>
            </div>

            <!-- Convert to Dimensionless Section -->
            <div class="converter-section">
                <h2>Physical to Dimensionless</h2>
                <div class="input-group">
                    <label for="I">Physical Current (I) [A]</label>
                    <input id="I" type="number" step="any">
                </div>
                <div class="input-group">
                    <label for="Phi">Physical Flux (Φ) [Wb]</label>
                    <input id="Phi" type="number" step="any">
                </div>
                <div class="input-group">
                    <label for="M">Physical Mutual Inductance (M) [H]</label>
                    <input id="M" type="number" step="any">
                </div>
                <div class="input-group">
                    <label for="t">Physical Time (t) [s]</label>
                    <input id="t" type="number" step="any">
                </div>
                <div class="input-group">
                    <label for="G_fq">Physical Flux Quantum Rate (G_fq) [Hz]</label>
                    <input id="G_fq" type="number" step="any">
                </div>
                <button onclick="convertToDimensionless()">Convert to Dimensionless Units</button>
                <div id="dimensionlessResult" class="result"></div>
            </div>

            <!-- Constants Section -->
            <div class="equations">
                <div class="tab-container">
                    <button class="tab-button active" onclick="switchTab('equations-tab')">Equations</button>
                    <button class="tab-button" onclick="switchTab('constants-tab')">Constants</button>
                </div>

                <div id="equations-tab" class="tab-content active">
                    <h2>Conversion Equations</h2>
                    <div id="equations">
                        <h3>Physical to Dimensionless</h3>
                        <p>\[i = \frac{I}{I_c}\]</p>
                        <p>\[\phi = \frac{\Phi}{\Phi_0}\]</p>
                        <p>\[J = M \cdot \frac{I_c}{\Phi_0}\]</p>
                        <p>\[t' = t \cdot \omega_c\]</p>
                        <p>\[g_{fq} = \frac{2\pi}{\omega_c} \cdot G_{fq}\]</p>

                        <h3>Derived Quantities</h3>
                        <p>\[\omega_c = \frac{2\pi r_{jj} I_c}{\Phi_0}\]</p>
                        <p>\[\alpha = \frac{r_{leak}}{r_{jj}}\]</p>
                        <p>\[\beta = \frac{2\pi L I_c}{\Phi_0}\]</p>
                        <p>\[\gamma = \frac{1}{\beta}\]</p>
                        <p>\[\tau = \frac{\beta}{\alpha}\]</p>
                    </div>
                </div>

                <div id="constants-tab" class="tab-content">
                    <h2>Physical Constants</h2>
                    <div class="constants-grid">
                        <div class="input-group">
                            <label for="I_c">Critical Current (I_c) [A]</label>
                            <input id="I_c" type="number" step="any" value="100e-6">
                        </div>
                        <div class="input-group">
                            <label for="r_jj">Shunt Resistance (r_{jj}) [Ω]</label>
                            <input id="r_jj" type="number" step="any" value="2.56">
                        </div>
                        <div class="input-group">
                            <label for="L">Inductance (L) [H]</label>
                            <input id="L" type="number" step="any" value="1e-9">
                        </div>
                        <div class="input-group">
                            <label for="Phi_0">Flux Quantum (Φ₀) [Wb]</label>
                            <input id="Phi_0" type="number" step="any" value="2.07e-15">
                        </div>
                        <div class="input-group">
                            <label for="r_leak">Leak Resistance (r_{leak}) [Ω]</label>
                            <input id="r_leak" type="number" step="any" value="1.0">
                        </div>
                        
                        <div class="derived-constants">
                            <h3>Derived Constants</h3>
                            <p>\[\omega_c = \]<span id="omega_c"></span> \[\text{ rad/s}\]</p>
                            <p>\[\alpha = \]<span id="alpha"></span></p>
                            <p>\[\beta = \]<span id="beta"></span></p>
                            <p>\[\gamma = \]<span id="gamma"></span></p>
                            <p>\[\tau = \]<span id="tau"></span></p>
                        </div>
                        <button onclick="updateConstants()" class="update-constants-btn">Update Constants</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function formatScientific(num) {
            if (num === undefined || num === null) return '';
            const str = num.toExponential(4);
            let [coef, exp] = str.split('e');
            exp = parseInt(exp);
            return `${coef} \\times 10^{${exp}}`;
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }

        async function updateConstants() {
            const button = document.querySelector('.update-constants-btn');
            try {
                button.classList.add('loading');
                button.textContent = 'Updating...';

                const constants = {
                    I_c: parseFloat(document.getElementById('I_c').value),
                    r_jj: parseFloat(document.getElementById('r_jj').value),
                    r_leak: parseFloat(document.getElementById('r_leak').value),
                    L: parseFloat(document.getElementById('L').value),
                    Phi_0: parseFloat(document.getElementById('Phi_0').value)
                };

                const response = await fetch('/update_constants', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(constants)
                });

                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json();

                document.getElementById('omega_c').innerHTML = formatScientific(data.omega_c);
                document.getElementById('alpha').innerHTML = formatScientific(data.alpha);
                document.getElementById('beta').innerHTML = formatScientific(data.beta);
                document.getElementById('gamma').innerHTML = formatScientific(data.gamma);
                document.getElementById('tau').innerHTML = formatScientific(data.tau);

                MathJax.typeset([document.querySelector('.derived-constants')]);

            } catch (error) {
                alert('Error updating constants: ' + error.message);
            } finally {
                button.classList.remove('loading');
                button.textContent = 'Update Constants';
            }
        }

        async function convertToPhysical() {
            const button = document.querySelector('button');
            const result = document.getElementById('physicalResult');
            try {
                button.classList.add('loading');
                button.textContent = 'Converting...';

                const data = {
                    i: parseFloat(document.getElementById('i').value),
                    phi: parseFloat(document.getElementById('phi').value),
                    J: parseFloat(document.getElementById('J').value),
                    t_prime: parseFloat(document.getElementById('t_prime').value),
                    g_fq: parseFloat(document.getElementById('g_fq').value)
                };

                const response = await fetch('/convert_to_physical', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (!response.ok) throw new Error('Network response was not ok');
                const resultData = await response.json();

                result.innerHTML = `
                    <p>\\[I = ${formatScientific(resultData.I)} \\,\\text{A}\\]</p>
                    <p>\\[\\Phi = ${formatScientific(resultData.Phi)} \\,\\text{Wb}\\]</p>
                    <p>\\[M = ${formatScientific(resultData.M)} \\,\\text{H}\\]</p>
                    <p>\\[t = ${formatScientific(resultData.t)} \\,\\text{s}\\]</p>
                    <p>\\[G_{fq} = ${formatScientific(resultData.G_fq)} \\,\\text{Hz}\\]</p>
                `;
                MathJax.typeset([result]);
            } catch (error) {
                result.innerHTML = `<p style="color:red;">Error: ${error.message}</p>`;
            } finally {
                button.classList.remove('loading');
                button.textContent = 'Convert to Physical Units';
            }
        }

        async function convertToDimensionless() {
            const button = document.querySelectorAll('button')[1];
            const result = document.getElementById('dimensionlessResult');
            try {
                button.classList.add('loading');
                button.textContent = 'Converting...';

                const data = {
                    I: parseFloat(document.getElementById('I').value),
                    Phi: parseFloat(document.getElementById('Phi').value),
                    M: parseFloat(document.getElementById('M').value),
                    t: parseFloat(document.getElementById('t').value),
                    G_fq: parseFloat(document.getElementById('G_fq').value)
                };

                const response = await fetch('/convert_to_dimensionless', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (!response.ok) throw new Error('Network response was not ok');
                const resultData = await response.json();

                result.innerHTML = `
                    <p>\\[i = ${formatScientific(resultData.i)}\\]</p>
                    <p>\\[\\phi = ${formatScientific(resultData.phi)}\\]</p>
                    <p>\\[J = ${formatScientific(resultData.J)}\\]</p>
                    <p>\\[t' = ${formatScientific(resultData.t_prime)}\\]</p>
                    <p>\\[g_{fq} = ${formatScientific(resultData.g_fq)}\\]</p>
                `;
                MathJax.typeset([result]);
            } catch (error) {
                result.innerHTML = `<p style="color:red;">Error: ${error.message}</p>`;
            } finally {
                button.classList.remove('loading');
                button.textContent = 'Convert to Dimensionless Units';
            }
        }

        MathJax.startup.ready.then(() => {
            MathJax.typeset();
            updateConstants();
        });
    </script>
</body>
</html>
